# 実装計画

## 音声サービス基盤

- [ ] 1. 音声管理サービスの基盤実装
  - services/AudioManager.js を作成し、HTML5 Audio APIのラッパークラスを実装
  - 音量管理、ミュート機能、再生制御の基本メソッドを実装
  - エラーハンドリングとフォールバック処理を実装
  - AudioManagerのユニットテストを作成
  - _要件: 1.1, 1.5, 3.1, 3.2, 3.5_

- [ ] 2. 音声許可ハンドラーの実装
  - services/AudioPermissionHandler.js を作成
  - ブラウザの自動再生ポリシー検出ロジックを実装
  - ユーザー操作による音声許可取得フローを実装
  - モバイルデバイス対応の特別処理を追加
  - _要件: 3.1, 3.2, 3.4_

- [ ] 3. 音声プリローダーの実装
  - services/AudioPreloader.js を作成
  - 音声ファイルの非同期読み込みとキャッシング機能を実装
  - Web Audio APIフォールバック（SoundGenerator.js）を実装
  - プリロード状態管理とエラーハンドリングを追加
  - _要件: 3.3, 4.1, 4.3, 4.5_

## Vuex統合

- [ ] 4. 音声状態管理ストアの実装
  - store/audio.js を作成
  - 音声設定の状態（enabled、volume、muted、personalMode）を定義
  - ミューテーション（SET_ENABLED、SET_VOLUME等）を実装
  - アクション（initializeAudio、updateVolume等）を実装
  - localStorageとの同期処理を実装
  - _要件: 2.5, すべての要件に対する基盤設定_

- [ ] 5. 既存clockストアとの統合
  - store/clock.js を修正し、時間イベントでaudioアクションを呼び出す
  - decreaseTimeでの10秒警告検出ロジックを追加
  - changeTurnでのターン切り替えイベント発火を実装
  - 秒読みカウントダウンの状態管理を追加
  - _要件: 1.1, 1.2, 1.3, 1.4_

## UIコンポーネント

- [ ] 6. 音声コントロールコンポーネントの実装
  - components/AudioControl.vue を作成
  - 音声ON/OFF切り替えボタンを実装
  - 音量スライダーコンポーネントを実装
  - 個人音声モードの切り替えUIを実装
  - Bootstrap-Vueでレスポンシブデザインを適用
  - _要件: 2.2, 2.3, 2.5_

- [ ] 7. プレイヤー識別マークコンポーネントの実装
  - components/PlayerMark.vue を作成
  - 自分のプレイヤーを示すアイコン表示を実装
  - 現在ターンのプレイヤーハイライト機能を実装
  - CSSアニメーションで視覚的フィードバックを追加
  - _要件: 2.1, 2.4_

- [ ] 8. Clockコンポーネントの音声統合
  - components/Clock.vue を修正
  - AudioControlとPlayerMarkコンポーネントを組み込み
  - ターン切り替え時の音声イベント発火を実装
  - 時間表示更新時の音声チェックロジックを追加
  - _要件: 1.1, 1.2, 1.3, 1.4, 2.1_

## 音声再生実装

- [ ] 9. ターン切り替え音の実装
  - AudioManagerにplayTurnChangeメソッドを実装
  - 個人音声モードでの条件付き再生ロジックを追加
  - Socket.ioイベントとの連携を実装
  - 音声再生のテストケースを作成
  - _要件: 1.1, 2.2, 2.3_

- [ ] 10. 時間警告音の実装
  - AudioManagerにplayTimeWarningメソッドを実装
  - 10秒前検出ロジックとの統合
  - 警告音の重複防止処理を実装
  - 個人モードでの条件付き再生を追加
  - _要件: 1.2, 2.2, 2.3_

- [ ] 11. 秒読みカウントダウン音の実装
  - AudioManagerにplayCountdownメソッドを実装
  - 9-6秒の短いピッ音再生ロジックを実装
  - 5-1秒の1秒間継続ピー音再生ロジックを実装
  - 秒読み状態管理との統合
  - _要件: 1.4, 2.2, 2.3_

- [ ] 12. 時間切れアラート音の実装
  - AudioManagerにplayTimeUpメソッドを実装
  - 時間切れ検出との統合
  - アラート音の確実な再生保証処理を追加
  - 個人モードでの条件付き再生を実装
  - _要件: 1.3, 2.2, 2.3_

## 音声素材とフォールバック

- [ ] 13. 音声ファイルの配置と設定
  - static/sounds/ディレクトリを作成
  - 音声ファイルのプレースホルダーを配置（またはWeb Audio API生成を設定）
  - 音声ファイルパスの設定管理を実装
  - ファイル存在チェックとフォールバック切り替えを実装
  - _要件: 3.3, 4.1, 4.3_

- [ ] 14. Web Audio APIフォールバックの完全実装
  - SoundGeneratorクラスの各音声生成メソッドを完成
  - AudioManagerでのフォールバック自動切り替えを実装
  - ブラウザ互換性チェックを追加
  - フォールバック時のパフォーマンス最適化
  - _要件: 3.3, 4.2, 4.4_

## テストとパフォーマンス

- [ ] 15. 音声機能の統合テスト
  - Clock.vueとAudioManagerの統合テストを作成
  - 時間イベントと音声再生の連携テストを実装
  - 個人音声モードの動作テストを追加
  - Socket.io同期での音声動作テストを作成
  - _要件: すべての要件に対するE2E検証_

- [ ] 16. パフォーマンス最適化
  - 音声プリロードのタイミング最適化
  - メモリ使用量の監視と最適化
  - 音声再生遅延の測定と改善
  - 低スペックデバイスでの動作確認と調整
  - _要件: 4.1, 4.2, 4.3, 4.4, 4.5_

- [ ] 17. ブラウザ互換性テスト
  - Chrome、Firefox、Safari、Edgeでの動作確認
  - モバイルブラウザ（iOS Safari、Chrome）での検証
  - 音声許可フローの各ブラウザ対応確認
  - エラーハンドリングの網羅的テスト
  - _要件: 3.1, 3.2, 3.3, 3.4, 3.5_